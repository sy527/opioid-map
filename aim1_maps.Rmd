---
title: "2014 to 2019 Monthly Map"
author: "SunJung Yoon"
date: "`r Sys.Date()`"
output: distill::distill_article
description: |
  The two maps show drug purchasing and payment amount received on a physician level from 2014 to 2019
---

```{r setup, include=FALSE}
# install.packages("psych")
# install.packages("kableExtra")
library(tidyverse)
library(psych)
library(kableExtra)
```

```{r, echo = FALSE}

# run the map.R program before using this program
# source("programs/analysis/map.R")
# from 13_arcos_openpayment.R
load("I:/Research/sunyoon/research/cleandata/complete/map.RData")

```


```{r, echo = FALSE, include = FALSE}
reclass_map <- read_csv("I:/Research/sunyoon/research/cleandata/npi/reclass.csv") %>%
  select(Classification, Reclass) %>%
  distinct() %>%
  deframe()

general_map <- read_csv("I:/Research/sunyoon/research/cleandata/npi/reclass.csv") %>%
  select(Classification, General) %>%
  distinct() %>%
  deframe()

general_map2 <- read_csv("I:/Research/sunyoon/research/cleandata/npi/reclass.csv") %>%
  select(Classification, General2) %>%
  distinct() %>%
  deframe()

library(sf)
# Apply reclassification


map <- map %>%
  st_drop_geometry() %>%
  select(-ends_with("BUPRENORPHINE"), -ends_with("METHADONE")) %>%
  mutate(reclass = recode(Classification, !!!reclass_map),
         general = recode(Classification, !!!general_map),
         general2 = recode(Classification, !!!general_map2)) %>%
  filter(reclass != "Drop")



# keep just the matched NPIs
map <- map %>%
  st_drop_geometry() %>%
  filter(matched == "ARCOS_OPEN") %>%
   mutate(
    totalMME = rowSums(across(starts_with("totalMME_")), na.rm = TRUE),
    totalgm = rowSums(across(starts_with("totalgm_")), na.rm = TRUE), 
    totalQ = rowSums(across(starts_with("totalQ_")), na.rm = TRUE)
  )

```


Hello everyone! My name is Sun and I am a 5th-year Health Services Research Ph.D. student at the University of Maryland, College Park. My current research interests lie in substance use disorder and mental health. If you have any comments about this work or just want to chat, please feel free to reach out at <sy527@umd.edu>. I am currently exploring postdoctoral opportunities beginning in Fall 2026, so if you or your colleagues are looking for someone in this area, I would love to connect!

```{r, echo = FALSE}
knitr::include_graphics("I:/Research/sunyoon/research/programs/analysis/APPAM/map/mme.gif")
```

```{r, echo = FALSE}
knitr::include_graphics("I:/Research/sunyoon/research/programs/analysis/APPAM/map/pay.gif")
```


